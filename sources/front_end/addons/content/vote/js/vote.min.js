TZ_Portfolio_PlusAddOnContentVote=window.TZ_Portfolio_PlusAddOnContentVote||{basePath:"",addonId:0,articleId:0,referView:"",referModule:"",referLayout:""},function(t,e,o,a,r,i){"use strict";t.tzPortfolioPlusAddOnVote=function(r,n){var d=t.tzPortfolioPlusAddOnVote,l=t(r),s=t.extend(!0,t.extend(!0,{},t.tzPortfolioPlusAddOnVote.defaults),n),f=!1,c=s.loadingTemplate,u=s.notification,p=s.basePath;return p||(p=i.basePath),/\/$/.test(p)||(p+="/"),c=c.replace("{basepath}",p),l.processVote=function(r){s.beforeVote();var p="",P={},m=t(c);r.parents(s.mainSelector).append(m),s.ajaxUrl?p=s.ajaxUrl:(p="index.php?option=com_tz_portfolio_plus&view=addon&addon_task=vote.vote",P.addon_id=r.data("rating-addon-id")?r.data("rating-addon-id"):s.addonId,r.data("rating-addon-id")||n.addonId||(P.addon_id=i.addonId),P.cid=r.data("rating-article-id")?r.data("rating-article-id"):s.articleId,r.data("rating-article-id")||n.articleId||(P.cid=i.articleId),P.user_rating=r.data("rating-point")?r.data("rating-point"):s.ratingPoint,s.referView&&(P.referview=s.referView),!n.referView&&i.referView&&(P.referview=i.referView),s.referModule&&(P.refermodule=s.referModule),!n.referModule&&i.referModule&&(P.refermodule=i.referModule),s.referLayout&&(P.referlayout=s.referLayout),!n.referLayout&&i.referLayout&&(P.referlayout=i.referLayout),s.Itemid&&(P.Itemid=s.Itemid)),void 0!==d._notification&&d._notification.dismiss(),t.ajax({url:p,type:s.ajaxType,data:P,dataType:s.ajaxDataType}).done(function(i){if(1==i.success&&!t.isEmptyObject(i.data)){var n=r.parents(s.mainSelector),c=i.data.rating_count,p=i.data.rating_sum/c,P=n.find(s.itemSelector),g=t(s.votedTemplate?s.votedTemplate:"<span></span>");if(s.votedTemplate||g.addClass(P.clone().removeClass(s.votedClass).attr("class")),P.removeClass(s.votedClass).html("").not(":lt("+(5-Math.ceil(p))+")").addClass(s.votedClass),p-parseInt(p)>0&&(g.css("width",100-Math.round(100*(p-parseInt(p)))+"%"),P.eq(5-Math.ceil(p)).html(g)),n.find(s.counterSelector).length){var _=a.JText._("PLG_CONTENT_VOTE_VOTES"),V=s.votedCounterTpl;i.data.rating_count<2&&(_=a.JText._("PLG_CONTENT_VOTE_VOTES_1")),_=_.replace("%d",i.data.rating_count),V=V.replace("{votedcounter}",_),n.find(s.counterSelector).html(V)}d.originalJS||l.itemClick(n.find(s.itemSelector))}s.ajaxComplete(i,n,c,p);var v=new o.NotificationFx({wrapper:u.wrapper?u.wrapper:e.body,message:i.message,layout:u.layout,effect:u.effect,type:1!=i.success?"success":"error",ttl:u.ttl,onOpen:function(){t(v.options.wrapper).find(v.ntf).width("auto"),u.onOpen()},onClose:function(){u.onClose()}});d._notification=v,v.show(),m.remove(),f=!1}),s.afterVote(l)},l.itemClick=function(e){e.off("click").on("click",function(e){if(e.preventDefault(),!f){f=!0;var o=t(this);l.processVote(o)}})},d.originalJS?l.processVote(l):l.itemClick(l.find(s.itemSelector)),void 0!==typeof TZ_Portfolio_Plus.infiniteScroll&&void 0!==TZ_Portfolio_Plus.infiniteScroll.addAjaxComplete&&TZ_Portfolio_Plus.infiniteScroll.addAjaxComplete(function(t,e){var o=t.find(s.mainSelector);o.tzPortfolioPlusAddOnVote(s),s.ajaxScrollComplete(o,t,e)}),l.vars=s,t.data(r,"tzPortfolioPlusAddOnVote",l),this},t.tzPortfolioPlusAddOnVote.originalJS=!1,t.tzPortfolioPlusAddOnVote.defaults={basePath:"",ajaxUrl:"",ajaxType:"POST",ajaxDataType:"json",counterSelector:".js-tpp-counter",mainSelector:".content_rating",itemSelector:".rating > a",addonId:0,referModule:"",referView:"",referLayout:"",articleId:0,ratingPoint:0,ratingCount:0,ratingTotal:0,ratingMax:5,votedClass:"voted",votedTemplate:"",votedCounterTpl:"<small>({votedcounter})</small>",loadingTemplate:'<img src="{basepath}images/loading.gif" class="loading" border="0" align="absmiddle" /> ',notification:{wrapper:e.body,layout:"growl",effect:"scale",ttl:3e3,onClose:function(){return!1},onOpen:function(){return!1}},beforeVote:function(){},afterVote:function(){},ajaxComplete:function(t){},ajaxScrollComplete:function(t,e,o){}},t.fn.tzPortfolioPlusAddOnVote=function(e){if(void 0===e&&(e={}),"object"==typeof e)return this.each(function(o,a){void 0===t(this).data("tzPortfolioPlusAddOnVote")?new t.tzPortfolioPlusAddOnVote(this,e):t(this).data("tzPortfolioPlusAddOnVote")})},o.JVXVote=function(e,o,a,r,i,n,d){t.tzPortfolioPlusAddOnVote.originalJS=!0;var l=t(e),s=l.data("tzPortfolioPlusAddOnVote");void 0!==s&&s.processVote(l),l.tzPortfolioPlusAddOnVote({mainSelector:".content_rating",itemSelector:".rating > a",counterSelector:"#TzVote_"+o,articleId:o,ratingPoint:a,ratingTotal:r,ratingCount:i})}}(jQuery,document,window,Joomla,TZ_Portfolio_Plus,TZ_Portfolio_PlusAddOnContentVote);